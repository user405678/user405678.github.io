<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CONTEXTO</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/typo-js/1.2.2/typo.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Leaderboard Announcement Toast -->
  <div id="leaderboardToast" class="leaderboard-toast">
    <button class="toast-close" id="closeToast">‚úï</button>
    <div class="toast-content">
      <h3>üéâ New Feature!</h3>
      <p>Check out the new contexto global leaderboard! Click ‚û°Ô∏è on the floating leaderboard on this page to be redirected.</p>
      <p>Win tracking began February 8th.</p>
      <p>Click "Streamer" and enter your username to see stats for your live only.</p>
    </div>
  </div>

  <!-- =============================== -->
  <!-- üéÆ CONTEXTO MAIN GAME -->
  <!-- =============================== -->
  <div class="contexto">
    <div class="container">
      <div class="header">
        <div class="title-container">
          
          <div class="title">INTERACTIVE CONTEXTO</div>
          &nbsp;
          <img src="https://www.runchatcapture.com/assets/imgs/interactive_contexto_logo.png" alt="Interactive Contexto" class="interactive-logo">
        </div>
        <button class="menu-button" id="menuButton" style="width: 30px;">‚ãÆ</button>
      </div>

      <div class="game-info">
        <span class="label" style="font-size: 14px;">GUESSES:</span> <span id="guessCount">0</span>
        <span class="label" style="font-size: 14px;">LAST WORD:</span> <span id="lastWord"></span>
        <img src="https://www.runchatcapture.com/assets/imgs/spellcheck.png" id="spellcheckToggle" class="spellcheck-toggle" alt="Toggle Spellcheck">
        <img src="https://www.runchatcapture.com/assets/imgs/acceptdupes.png" id="dupesToggle" class="spellcheck-toggle" alt="Toggle Duplicate Guesses">
      </div>

      <div class="input-container">
        <input type="text" class="word-input" id="wordInput" placeholder="type a word">
      </div>

      <div class="error" id="errorMessage"></div>
      <div class="last-guess" id="lastGuess"></div>
      <div id="loading">Loading game data...</div>
      <div class="guesses-container" id="guessesContainer"></div>
    </div>

    <!-- CONTEXTO MENU OVERLAY -->
    <div class="contexto-overlay" id="menuOverlay">
      <div class="contexto-modal">
        <div class="menu-option" id="howToPlay"><i>?</i> How to play</div>
        <div class="menu-option" id="hintOption"><i>üí°</i> Hint</div>
        <div class="menu-option" id="giveUp"><i>üè≥Ô∏è</i> Give up</div>
        <!-- <div class="menu-option" id="settings"><i>‚öôÔ∏è</i> Settings</div>
        <div class="menu-option" id="faq"><i>‚ùì</i> FAQ</div> -->
      </div>
    </div>

    <!-- HOW TO PLAY OVERLAY -->
    <div class="contexto-overlay" id="howToPlayOverlay">
      <div class="contexto-modal">
        <button class="close-modal" id="closeHowToPlay">‚úï</button>
        <div class="how-to-play-content">
          <p><strong>Find the secret word. You have unlimited guesses.</strong></p>
        </br>
          <p><strong>The words were sorted by an artificial intelligence algorithm according to how similar they were to the secret word.</strong></p>
        </br>
          <p><strong>After submitting a word, you will see its position. The secret word is number 1.</strong></p>
        </br>
          <p><strong>The algorithm analyzed thousands of texts. It uses the context in which words are used to calculate the similarity between them.</strong></p>
        </br>
          <!-- <div class="icon-key">
            <h3>Icon Key</h3>
            <div class="icon-item">
              <img src="https://www.runchatcapture.com/assets/imgs/spellcheck.png" alt="Spellcheck On">
              <p>Spellcheck is enabled - words will be checked against a dictionary</p>
            </div>
            <div class="icon-item">
              <img src="https://www.runchatcapture.com/assets/imgs/nospellcheck.png" alt="Spellcheck Off">
              <p>Spellcheck is disabled - any word will be accepted</p>
            </div>
            <div class="icon-item">
              <img src="https://www.runchatcapture.com/assets/imgs/acceptdupes.png" alt="Accept Duplicates">
              <p>Duplicate guesses are allowed</p>
            </div>
            <div class="icon-item">
              <img src="https://www.runchatcapture.com/assets/imgs/blockdupes.png" alt="Block Duplicates">
              <p>Duplicate guesses are blocked</p>
            </div>
          </div> -->
        </div>
      </div>
    </div>

    <!-- CONGRATS OVERLAY -->
    <div class="contexto-overlay" id="congratsOverlay">
      <div class="contexto-modal">
        <div class="congrats-content">
          <p><strong>Congrats!</strong></p>
          <p>You got the word <strong id="winningWordText"></strong> in <strong id="finalGuessCount"></strong> guesses.</p>
          <p class="promo-text">Automate this game for <br/>TikTok and Twitch at:</p>
          <p><span class="website-link">RunChatCapture.com</span></p>
          <p><strong id="playAgain">Play again</strong></p>
        </div>
      </div>
    </div>

    
  </div>

  <!-- =================================== -->
  <!-- ‚öôÔ∏è TEMPLATE COMPONENTS BELOW -->
  <!-- =================================== -->

  <!-- Winning Modal -->
  <div id="winning-overlay" class="winning-overlay">
    <div id="winning-modal" class="winning-modal">
      <div id="winning-title" class="winning-title"></div>
      <div id="single-winner" class="single-winner">
        <img id="winner-photo" class="winner-photo" src="" alt="Winner">
      </div>
      <div id="multiple-winners" class="multiple-winners"></div>
      <div id="winning-site" class="winning-site">RunChatCapture.com</div>
    </div>
  </div>

  <!-- Instruction Popup -->
  <div id="instruction-popup" class="instruction-popup">
    <div id="instruction-popup-content" class="instruction-popup-content">
      <div id="instruction-popup-text-display" class="instruction-popup-text"></div>
      <img id="instruction-popup-gif-display" class="instruction-popup-gif" src="" alt="" style="display:none;">
    </div>
  </div>

  <!-- Settings Panel -->
  <div id="settings-panel" class="settings-panel">
    <div class="settings-header">
      <h2>Settings</h2>
      <button id="close-settings" class="close-btn">√ó</button>
    </div>

    <div id="game-settings-section" class="settings-section">
      <div id="game-settings-header" class="settings-section-header">
        <h3>Game Settings</h3>
        <span class="arrow">‚ñº</span>
      </div>
      <div id="game-settings-content" class="settings-section-content">
        <div class="setting-item">
          <label for="contextoDarkToggle">Dark Mode:</label>
          <input type="checkbox" id="contextoDarkToggle" class="setting-checkbox">
        </div>
        <!-- Custom Game Creator (moved from modal) -->
        <div class="setting-item" id="gameCreationUI">
          <div class="select-game-header">Create custom game or select randomly:</div>
          <div class="custom-game-input">
            <div class="password-input-container">
              <input type="text" id="customWordInput" placeholder="Enter a secret word">
            </div>
            <button id="createCustomGame">Create Game</button>
            <button id="randomGame" class="random-button">Generate Random Game</button>
          </div>
          <div class="loading-text" id="loadingGame" style="display: none;">
            <span class="spinner"></span> Creating your game...
          </div>
          <div id="customGameError" class="error-text" style="display: none;"></div>
        </div>
        <div id="wordCheckUI" class="word-check-container" style="display: none;">
          <p>This word is not within the vocabulary.</p>
          <p>Closest similar secret word: <strong id="suggestedWordDisplay"></strong></p>
          <p>Would you like to accept this similar word?</p>
          <div class="word-check-buttons">
            <button id="backToInput" class="back-btn">Back</button>
            <button id="acceptSimilarWord" class="continue-btn">Continue</button>
          </div>
        </div>
        <div id="successMessageUI" class="success-message" style="display: none;">
          <p>Your game has been created!</p>
          <button id="continueToGame" class="continue-btn">Continue</button>
        </div>

        <!-- Automated Word List -->
        <div class="setting-item" id="automatedListUI" style="display: block; margin-top: 20px;">
          <div class="select-game-header">Enter Automated List of Words:</div>
          <div style="font-size: 12px; color: #b6b6b6; margin-bottom: 8px;">
            The game will automatically choose from this list until it finishes. <b style="color: #f2c4c4;">(Max: 100 words)</b><br>
            Words will be removed as they're completed. Clear the input to abandon the list.<br>
            Invalid words are replaced automatically.
          </div>
          <textarea id="automatedWordListInput" class="setting-textarea" rows="4" placeholder="Enter words separated by commas (e.g., apple, peach, cherry)"></textarea>
          <div style="margin-top: 8px;">
            <button id="startAutomatedList">Start Automated List</button>
            <button id="clearAutomatedList" class="back-btn" 
            style="display: none; background-color: #f2c4c4; color: #803333; border: none; border-radius: 4px;">Clear List</button>
          </div>
          <div id="automatedListStatus" style="margin-top: 8px; font-weight: bold; color: #4CAF50; display: none;"></div>
          <div id="automatedListError" class="error-text" style="display: none;"></div>
        </div>

        <div class="setting-item">
          <label>‚û§ Current Answer:</label>
          <div id="current-answer-display" style="font-weight: bold; color: #4CAF50; font-size: 18px; letter-spacing: 2px; text-transform: uppercase;">Loading...</div>
        </div>
        <div class="setting-item">
          <label for="hint-gift-input">Hint Gift (Must match gift gallery name):</label>
          <input type="text" id="hint-gift-input" class="setting-input-wide" placeholder="e.g., Rose" />
        </div>
        <div class="setting-item">
          <button id="clear-leaderboard" class="test-btn">Clear Leaderboard</button>
        </div>
        <div class="setting-item">
          <label for="language-select">Language:</label>
          <select id="language-select" class="setting-select">
            <option value="en" selected>English</option>
            <!-- <option value="es">Espa√±ol</option> -->
          </select>
        </div>
      </div>
    </div>

    <div class="settings-section" style="display: none;">
      <div class="settings-section-header">
        <h3>Simulate Activity</h3>
        <span class="arrow">‚ñº</span>
      </div>
      <div class="settings-section-content">
        <div class="setting-item">
          <label for="simulate-guesses">Simulate Audience Guesses:</label>
          <input type="checkbox" id="simulate-guesses" class="setting-checkbox">
        </div>
      </div>
    </div>

    <div class="settings-section">
      <div class="settings-section-header">
        <h3>Winning Popup Settings</h3>
        <span class="arrow">‚ñº</span>
      </div>
      <div class="settings-section-content">
        <div class="setting-item">
          <label for="winning-sound-url">Winning Sound URL:</label>
          <input type="url" id="winning-sound-url" class="setting-input-wide" placeholder="https://example.com/sound.mp3" value="https://www.myinstants.com/media/sounds/applepay.mp3">
        </div>
        <div class="setting-item">
          <label for="winning-modal-duration">Modal Duration (seconds):</label>
          <div class="number-input-container">
            <button class="number-input-btn" id="decrease-duration">-</button>
            <input type="number" id="winning-modal-duration" class="setting-input" value="2" min="1" max="5">
            <button class="number-input-btn" id="increase-duration">+</button>
          </div>
        </div>
        <div class="setting-item">
          <button id="test-winning-sound" class="test-btn">Test Sound</button>
        </div>
      </div>
    </div>

    <div class="settings-section">
      <div class="settings-section-header">
        <h3>Instruction Popup Settings</h3>
        <span class="arrow">‚ñº</span>
      </div>
      <div class="settings-section-content">
        <div class="setting-item">
          <label for="instruction-popup-active">Show at Round Start:</label>
          <input type="checkbox" id="instruction-popup-active" class="setting-checkbox">
        </div>
        <div class="setting-item">
          <label for="instruction-popup-duration">Display Duration (seconds):</label>
          <div class="number-input-container">
            <button class="number-input-btn" id="decrease-instruction-duration">-</button>
            <input type="number" id="instruction-popup-duration" class="setting-input" value="3" min="1" max="10">
            <button class="number-input-btn" id="increase-instruction-duration">+</button>
          </div>
        </div>
        <div class="setting-item">
          <label for="instruction-popup-text">Instruction Text:</label>
          <textarea id="instruction-popup-text" class="setting-textarea" rows="3">Guess the word to win!
This is wordle with endless guesses.
There are single player and group modes.</textarea>
        </div>
        <div class="setting-item">
          <label for="instruction-popup-gif">GIF URL (optional):</label>
          <input type="url" id="instruction-popup-gif" class="setting-input-wide" placeholder="https://example.com/instruction.gif" value="https://media0.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif">
        </div>
        <div class="setting-item">
          <button id="test-instruction-popup" class="test-btn">Test Popup</button>
        </div>
      </div>
    </div>

    <div class="settings-section">
      <div class="settings-section-header">
        <h3>Text-to-Speech Settings</h3>
        <span class="arrow">‚ñº</span>
      </div>
      <div class="settings-section-content">
        <div class="setting-item">
          <label for="tts-enabled">Enable Text-to-Speech:</label>
          <input type="checkbox" id="tts-enabled" class="setting-checkbox">
        </div>
        <div class="setting-item">
          <label for="tts-voice">Voice:</label>
          <select id="tts-voice" class="setting-select">
            <option value="">Default Voice</option>
          </select>
        </div>
        <div class="setting-item">
          <label for="tts-volume">Volume:</label>
          <div class="number-input-container">
            <button class="number-input-btn" id="decrease-tts-volume">-</button>
            <input type="number" id="tts-volume" class="setting-input" value="50" min="0" max="100" step="10">
            <button class="number-input-btn" id="increase-tts-volume">+</button>
          </div>
        </div>
        <div class="setting-item">
          <label for="tts-rate">Speech Rate:</label>
          <div class="number-input-container">
            <button class="number-input-btn" id="decrease-tts-rate">-</button>
            <input type="number" id="tts-rate" class="setting-input" value="10" min="5" max="12" step="1">
            <button class="number-input-btn" id="increase-tts-rate">+</button>
          </div>
        </div>
        <div class="setting-item">
          <label for="tts-read-words">Read Every Word Entered:</label>
          <input type="checkbox" id="tts-read-words" class="setting-checkbox">
        </div>
        <div class="setting-item">
          <label for="tts-round-start-enabled">Round Start Announcements:</label>
          <input type="checkbox" id="tts-round-start-enabled" class="setting-checkbox">
        </div>
        <div class="setting-item">
          <label for="tts-round-start-texts">Round Start Messages (separate with ;):</label>
          <textarea id="tts-round-start-texts" class="setting-textarea" rows="3">Welcome to Wordle! Let's begin.; New round starting! Good luck!; Time to guess the word!</textarea>
        </div>
        <div class="setting-item">
          <label for="tts-game-won-enabled">Victory Announcements:</label>
          <input type="checkbox" id="tts-game-won-enabled" class="setting-checkbox">
        </div>
        <div class="setting-item">
          <label for="tts-game-won-texts">Victory Messages (separate with ;):</label>
          <textarea id="tts-game-won-texts" class="setting-textarea" rows="3">Congratulations! You won!; Excellent work! Victory achieved!; Well done! You guessed it!</textarea>
        </div>
        <div class="setting-item">
          <label for="tts-gameplay-enabled">Gameplay Announcements:</label>
          <input type="checkbox" id="tts-gameplay-enabled" class="setting-checkbox">
        </div>
        <div class="setting-item">
          <label for="tts-gameplay-interval">Announcement Interval (seconds):</label>
          <div class="number-input-container">
            <button class="number-input-btn" id="decrease-tts-interval">-</button>
            <input type="number" id="tts-gameplay-interval" class="setting-input" value="30" min="10" max="300" step="10">
            <button class="number-input-btn" id="increase-tts-interval">+</button>
          </div>
        </div>
        <div class="setting-item">
          <label for="tts-gameplay-texts">Gameplay Messages (separate with ;):</label>
          <textarea id="tts-gameplay-texts" class="setting-textarea" rows="3">Keep going! You can do it!; Think carefully about your next guess.; You're doing great!</textarea>
        </div>
        <div class="setting-item">
          <button id="test-tts" class="test-btn">Test TTS</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Toggle Button -->
  <button id="settings-toggle" class="settings-toggle">
    <svg viewBox="0 0 24 24" width="24" height="24">
      <path fill="currentColor" d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
    </svg>
  </button>

  <!-- Floating Leaderboard -->
  <div id="floatingLeaderboard" class="floating-leaderboard">
    <div class="floating-leaderboard-header" id="leaderboardHeader">
      <span>üèÜ Leaderboard</span>
      <div class="leaderboard-controls">
        <button id="prevLeaderboardPage" class="leaderboard-nav-btn">‚Äπ</button>
        <span id="leaderboardPageInfo" class="leaderboard-page-info">1/1</span>
        <button id="nextLeaderboardPage" class="leaderboard-nav-btn">‚Ä∫</button>
          <button id="toggleLeaderboardOpacity" class="leaderboard-nav-btn" title="Toggle Opacity">‚óê</button>
        <button id="toggleFloatingLeaderboard" class="floating-leaderboard-toggle">‚àí</button>
        <a href="http://www.runchatcapture.com/play/contexto/l/index.html?timeRange=today" target="_blank" class="leaderboard-nav-btn" title="View full leaderboard" style="text-decoration: none; display: inline-flex; align-items: center; justify-content: center;">‚û°Ô∏è</a>
      </div>
    </div>
    <div class="floating-leaderboard-body" id="floatingLeaderboardBody">
      <div class="leaderboard-list" id="leaderboardList">
        <div class="leaderboard-empty">No players yet</div>
      </div>
      <button id="toggleLeaderboardHeight" class="leaderboard-height-toggle" title="Toggle height">‚ÜïÔ∏è</button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="storage.js"></script>
  <script src="mongodbService.js"></script>
  <script src="contextoGame.js"></script> 
  <script src="gameManager.js"></script>
  <script src="settingsPanel.js"></script>
  <script src="tiktokEvents.js"></script>
  <script src="leaderboard.js"></script>
</body>
</html>
